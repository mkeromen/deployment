<?php
define('SA_ACCESS_PATH', __DIR__ . '/config/super_administrateur_access.json');

/**
 * Implements hook_install()
 */
function deployment_install() {
    for($i = 7001; $i < 7100; $i++) {
        $candidate = 'deployment_update_' . $i;
        if(function_exists($candidate)) $candidate();
    }

}

/**
 * Utilisé pour exposer une page pour les tests
 * Implements hook_menu()
 * @return mixed
 */
function deployment_menu() {

    $items['test-deployment'] = array(
        'title' => 'Deployment page',
        'page callback' => '_test',
        'access arguments' => array('access content'),
        'type' => MENU_NORMAL_ITEM,
    );

    return $items;
}

function _test() {



    $modules = user_permission_get_modules();
    var_dump($modules);

    /*$rid = _get_rid_by_name('Super administrateur');
    //var_dump($rid);
    _set_user_permissions($rid, SA_ACCESS_PATH);*/

    return 'Test deployment';
}

/**
 * Implements hook_update_N()
 */
function deployment_update_7001() {
    features_revert(array('article'));
}

function deployment_update_7002() {
    variable_set('admin_theme', 'seven');
    variable_set('clean_url', 1);
}

function deployment_update_7003() {
    features_revert(array('article'));
}

function deployment_update_7004() {
    module_enable(array('fe_block'));
    features_revert(array('article'));
}

function deployment_update_7005() {
    theme_enable(array('deployment'));
    variable_set('theme_default', 'deployment');
    variable_set('node_admin_theme', 1);

    features_revert(array('accueil'));
    $nid = _create_node('page_d_accueil', 'Accueil');
    _set_new_role('Super administrateur', 3);
    variable_set('site_frontpage', 'node/' . $nid);
}

function deployment_update_7006() {
    module_enable(array('deployment_helper', 'menu', 'core_config_blocks'));
    features_revert(array('core_config_blocks'));
    $rid = _get_rid_by_name('Super administrateur');
    _set_user_permissions($rid, SA_ACCESS_PATH);
}

function deployment_update_7007() {
    $rid = _get_rid_by_name('Super administrateur');
    _set_user_permissions($rid, SA_ACCESS_PATH);
}

function deployment_update_7008() {
    $rid = _get_rid_by_name('Super administrateur');
    $fields = array(
        'name' => 'mkeromen',
        'mail' => 'mkeromen@absolunet.com',
        'pass' => 'sa',
        'init' => 'mkeromen@absolunet.com',
        'status' => 1,
        'roles' => array(
            $rid => 'Super administrateur'
        )
    );

    user_save('', $fields);
}

?>